<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lập kế hoạch đăng ký học phần cùng QHQT51</title>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #1976d2;
            --secondary-blue: #1565c0;
            --primary-red: #d32f2f;
            --secondary-red: #c62828;
            --light-blue: #e3f2fd;
            --light-red: #ffebee;
            --warning-bg: #fff3cd;
            --warning-border: #ffeeba;
            --warning-text: #856404;
            --success-bg: #e8f5e9;
            --success-border: #4caf50;
            --success-text: #2e7d32;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-600: #6c757d;
            --gray-800: #343a40;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Be Vietnam Pro', sans-serif;
        }

        body {
            background: var(--gray-100);
            min-height: 100vh;
            padding: 2rem;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            color: var(--gray-800);
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .important-notice {
            background-color: var(--light-red);
            border: 2px solid var(--primary-red);
            color: var(--primary-red);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            font-weight: 500;
        }

        .selected-classes-panel {
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--gray-200);
        }

        .panel-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-blue);
        }

        .time-group {
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: var(--gray-100);
            border-radius: 6px;
        }

        .time-header {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 0.5rem;
        }

        .subject-item {
            background: white;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            border: 1px solid var(--gray-300);
            font-size: 0.9rem;
        }

        .warning-message {
            background-color: var(--warning-bg);
            border: 1px solid var(--warning-border);
            color: var(--warning-text);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 6px;
            display: none;
        }

        .missing-subjects {
            background-color: var(--light-red);
            border: 1px solid var(--primary-red);
            color: var(--primary-red);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .missing-subjects ul {
            margin-top: 0.5rem;
            margin-left: 1.5rem;
        }
                .timetable-container {
            margin-top: 2rem;
            overflow-x: auto;
        }

        .timetable {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .timetable th {
            background: var(--primary-blue);
            color: white;
            padding: 1rem;
            font-weight: 600;
            text-align: center;
            font-size: 0.9rem;
        }

        .timetable td {
            border: 1px solid var(--gray-300);
            padding: 0.5rem;
            vertical-align: top;
            min-width: 150px;
            height: 120px;
        }

        .time-cell {
            background: var(--gray-100);
            font-weight: 500;
            text-align: center;
            width: 100px;
        }

        .ca-time {
            font-size: 0.8rem;
            color: var(--gray-600);
            display: block;
            margin-top: 0.25rem;
        }

        .class-slot {
            background: var(--light-blue);
            padding: 0.75rem;
            margin: 0.25rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.85rem;
            border: 1px solid rgba(25, 118, 210, 0.1);
        }

        .class-slot:hover {
            background: #bbdefb;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .class-slot.selected {
            background: var(--success-bg);
            border-color: var(--success-border);
            color: var(--success-text);
        }

        .class-slot.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--gray-200);
        }

        .class-slot.hidden {
            display: none;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .action-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            font-family: 'Be Vietnam Pro', sans-serif;
        }

        .action-button.primary {
            background: var(--primary-blue);
            color: white;
        }

        .action-button.primary:hover {
            background: var(--secondary-blue);
        }

        .action-button.secondary {
            background: var(--primary-red);
            color: white;
        }

        .action-button.secondary:hover {
            background: var(--secondary-red);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            margin: 15% auto;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .modal-content h3 {
            margin-bottom: 1rem;
            color: var(--gray-800);
            font-weight: 600;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .container {
                padding: 1rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-button {
                width: 100%;
            }

            .timetable {
                font-size: 0.8rem;
            }

            .class-slot {
                padding: 0.5rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Lập kế hoạch đăng ký học phần cùng QHQT51 ở Học kỳ 3</h1>
            <div class="important-notice">
                ĐÂY KHÔNG PHẢI LÀ TRANG WEB CHÍNH THỨC<br>
                Hãy nhớ đăng ký học phần chính thức trên hệ thống QLĐT vào 8h ngày 19/08/2025
            </div>
        </div>

        <!-- Selected Classes Panel -->
        <div class="selected-classes-panel">
            <div class="panel-header">
                <h2>Các lớp đã chọn</h2>
                <div class="action-buttons">
                    <button id="hideUnselectedBtn" class="action-button primary">Ẩn lớp không chọn</button>
                    <button id="clearSelectionsBtn" class="action-button secondary">Xóa tất cả lựa chọn</button>
                    <button id="exportBtn" class="action-button primary">Xuất TKB</button>
                </div>
            </div>
            <div id="organizedList"></div>
            <div id="missingSubjects" class="missing-subjects" style="display: none;"></div>
        </div>

        <!-- Warning Message -->
        <div id="warningMessage" class="warning-message"></div>

        <!-- Important Notices -->
        <div class="notice-section">
            <div class="important-notice">
                <strong>Nguyên tắc áp dụng:</strong>
                <ul>
                    <li>Đăng ký một lớp cho mỗi học phần</li>
                    <li>Không được đăng ký các lớp bị trùng thời gian học</li>
                    <li>Đối với môn Tiếng Anh chuyên ngành III, sinh viên phải chọn cả 2 lớp cùng số (ví dụ: 11.1 và 11.2)</li>
                    <li>Phải chọn 1 môn bổ trợ (3 tín chỉ)</li>
                <strong>Lưu ý khác:</strong>
                <ul>
                    <li>Website phù hợp nhất với các bạn học ngoại ngữ Tiếng Anh trình độ nâng cao</li>
                    <li>Website có thể xuất lịch thành file .txt</li>
                    <li>Website có thể có sai sót, hãy kiểm tra kỹ</li>
                </ul>
            </div>
        </div>

        <!-- Timetable -->
        <div class="timetable-container">
            <table class="timetable">
                <thead>
                    <tr>
                        <th>Ca</th>
                        <th>Thứ 2</th>
                        <th>Thứ 3</th>
                        <th>Thứ 4</th>
                        <th>Thứ 5</th>
                        <th>Thứ 6</th>
                        <th>Thứ 7</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="time-cell">
                            Ca 1<br>
                            <span class="ca-time">7:00 - 9:30</span>
                        </td>
                        <td id="cell-2-1"></td>
                        <td id="cell-3-1"></td>
                        <td id="cell-4-1"></td>
                        <td id="cell-5-1"></td>
                        <td id="cell-6-1"></td>
                        <td id="cell-7-1"></td>
                    </tr>
                    <tr>
                        <td class="time-cell">
                            Ca 2<br>
                            <span class="ca-time">9:45 - 12:15</span>
                        </td>
                        <td id="cell-2-2"></td>
                        <td id="cell-3-2"></td>
                        <td id="cell-4-2"></td>
                        <td id="cell-5-2"></td>
                        <td id="cell-6-2"></td>
                        <td id="cell-7-2"></td>
                    </tr>
                    <tr>
                        <td class="time-cell">
                            Ca 3<br>
                            <span class="ca-time">12:45 - 15:15</span>
                        </td>
                        <td id="cell-2-3"></td>
                        <td id="cell-3-3"></td>
                        <td id="cell-4-3"></td>
                        <td id="cell-5-3"></td>
                        <td id="cell-6-3"></td>
                        <td id="cell-7-3"></td>
                    </tr>
                    <tr>
                        <td class="time-cell">
                            Ca 4<br>
                            <span class="ca-time">15:30 - 18:00</span>
                        </td>
                        <td id="cell-2-4"></td>
                        <td id="cell-3-4"></td>
                        <td id="cell-4-4"></td>
                        <td id="cell-5-4"></td>
                        <td id="cell-6-4"></td>
                        <td id="cell-7-4"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
<script>
    // Class data will remain the same as in original file
    const classData = [
            // CNXHKH
            {
                maHocPhan: 'FC.002.02',
                tenHocPhan: 'Kinh tế chính trị Mác - Lê Nin',
                lopHocPhan: 'KTCTMLN-QHQT51',
                soThuTu: '1',
                thu: 2,
                ca: 3,
                phongHoc: 'A504',
                giangVien: ''
            },
            {
                maHocPhan: 'FC.002.02',
                tenHocPhan: 'Kinh tế chính trị Mác - Lê Nin',
                lopHocPhan: 'KTCTMLN-QHQT51',
                soThuTu: '2',
                thu: 2,
                ca: 4,
                phongHoc: 'A504',
                giangVien: ''
            },
            {
                maHocPhan: 'FC.002.02',
                tenHocPhan: 'Kinh tế chính trị Mác - Lê Nin',
                lopHocPhan: 'KTCTMLN-QHQT51',
                soThuTu: '3',
                thu: 4,
                ca: 3,
                phongHoc: 'A604',
                giangVien: ''
            },
            {
                maHocPhan: 'FC.002.02',
                tenHocPhan: 'Kinh tế chính trị Mác - Lê Nin',
                lopHocPhan: 'KTCTMLN-QHQT51',
                soThuTu: '4',
                thu: 4,
                ca: 4,
                phongHoc: 'A604',
                giangVien: ''
            },
            {
                maHocPhan: 'FC.002.02',
                tenHocPhan: 'Kinh tế chính trị Mác - Lê Nin',
                lopHocPhan: 'KTCTMLN-QHQT51',
                soThuTu: '5',
                thu: 5,
                ca: 3,
                phongHoc: 'A306',
                giangVien: ''
            },
            {
                maHocPhan: 'IL.003.02',
                tenHocPhan: 'Pháp luật đại cương',
                lopHocPhan: 'PLĐC-QHQT51',
                soThuTu: '1',
                thu: 3,
                ca: 3,
                phongHoc: 'D101',
                giangVien: ''
            },
            {
                maHocPhan: 'IL.003.02',
                tenHocPhan: 'Pháp luật đại cương',
                lopHocPhan: 'PLĐC-QHQT51',
                soThuTu: '2',
                thu: 3,
                ca: 4,
                phongHoc: 'D101',
                giangVien: ''
            },
            {
                maHocPhan: 'IL.003.02',
                tenHocPhan: 'Pháp luật đại cương',
                lopHocPhan: 'PLĐC-QHQT51',
                soThuTu: '3',
                thu: 6,
                ca: 3,
                phongHoc: 'A300',
                giangVien: ''
            },
            {
                maHocPhan: 'IL.003.02',
                tenHocPhan: 'Pháp luật đại cương',
                lopHocPhan: 'PLĐC-QHQT51',
                soThuTu: '4',
                thu: 6,
                ca: 4,
                phongHoc: 'A300',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.003.03',
                tenHocPhan: 'Phương pháp nghiên cứu quan hệ quốc tế',
                lopHocPhan: 'PPNCQHQT-QHQT51',
                soThuTu: '1',
                thu: 3,
                ca: 4,
                phongHoc: 'D209',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.003.03',
                tenHocPhan: 'Phương pháp nghiên cứu quan hệ quốc tế',
                lopHocPhan: 'PPNCQHQT-QHQT51',
                soThuTu: '2',
                thu: 2,
                ca: 4,
                phongHoc: 'D209',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.003.03',
                tenHocPhan: 'Phương pháp nghiên cứu quan hệ quốc tế',
                lopHocPhan: 'PPNCQHQT-QHQT51',
                soThuTu: '3',
                thu: 4,
                ca: 3,
                phongHoc: 'D101',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.003.03',
                tenHocPhan: 'Phương pháp nghiên cứu quan hệ quốc tế',
                lopHocPhan: 'PPNCQHQT-QHQT51',
                soThuTu: '4',
                thu: 4,
                ca: 4,
                phongHoc: 'D101',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.003.03',
                tenHocPhan: 'Phương pháp nghiên cứu quan hệ quốc tế',
                lopHocPhan: 'PPNCQHQT-QHQT51',
                soThuTu: '5',
                thu: 5,
                ca: 4,
                phongHoc: 'A504',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.041.03',
                tenHocPhan: 'Lịch sử quan hệ quốc tế hiện đại 2 (1945-nay)',
                lopHocPhan: 'LSQHQTHĐII-QHQT51',
                soThuTu: '1',
                thu: 2,
                ca: 3,
                phongHoc: 'A702',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.041.03',
                tenHocPhan: 'Lịch sử quan hệ quốc tế hiện đại 2 (1945-nay)',
                lopHocPhan: 'LSQHQTHĐII-QHQT51',
                soThuTu: '2',
                thu: 2,
                ca: 4,
                phongHoc: 'A702',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.041.03',
                tenHocPhan: 'Lịch sử quan hệ quốc tế hiện đại 2 (1945-nay)',
                lopHocPhan: 'LSQHQTHĐII-QHQT51',
                soThuTu: '3',
                thu: 4,
                ca: 3,
                phongHoc: 'D110',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.041.03',
                tenHocPhan: 'Lịch sử quan hệ quốc tế hiện đại 2 (1945-nay)',
                lopHocPhan: 'LSQHQTHĐII-QHQT51',
                soThuTu: '4',
                thu: 4,
                ca: 4,
                phongHoc: 'D110',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.041.03',
                tenHocPhan: 'Lịch sử quan hệ quốc tế hiện đại 2 (1945-nay)',
                lopHocPhan: 'LSQHQTHĐII-QHQT51',
                soThuTu: '5',
                thu: 5,
                ca: 4,
                phongHoc: 'A502',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.008.03',
                tenHocPhan: 'Lý luận quan hệ quốc tế',
                lopHocPhan: 'LLQHQT-QHQT51',
                soThuTu: '3',
                thu: 7,
                ca: 3,
                phongHoc: 'HTB',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.008.03',
                tenHocPhan: 'Lý luận quan hệ quốc tế',
                lopHocPhan: 'LLQHQT-QHQT51',
                soThuTu: '4',
                thu: 4,
                ca: 4,
                phongHoc: 'A400',
                giangVien: ''
            },
            {
                maHocPhan: 'IR.008.03',
                tenHocPhan: 'Lý luận quan hệ quốc tế',
                lopHocPhan: 'LLQHQT-QHQT51',
                soThuTu: '5',
                thu: 5,
                ca: 3,
                phongHoc: 'HTB',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Luật hiến pháp Việt Nam và các nước (Môn bổ trợ)',
                lopHocPhan: 'LHPVN&CN-ALL',
                soThuTu: '1',
                thu: 4,
                ca: 4,
                phongHoc: 'A400',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Công pháp quốc tế (Môn bổ trợ)',
                lopHocPhan: 'CPQT-ALL',
                soThuTu: '1',
                thu: 7,
                ca: 1,
                phongHoc: 'HTB',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Công pháp quốc tế (Môn bổ trợ)',
                lopHocPhan: 'CPQT-ALL',
                soThuTu: '2',
                thu: 4,
                ca: 3,
                phongHoc: 'HTB',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Công pháp quốc tế (Môn bổ trợ)',
                lopHocPhan: 'CPQT-ALL',
                soThuTu: '3',
                thu: 2,
                ca: 4,
                phongHoc: 'A404',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Kinh doanh quốc tế (Môn bổ trợ)',
                lopHocPhan: 'KDQT-ALL',
                soThuTu: '4',
                thu: 6,
                ca: 3,
                phongHoc: 'A400',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Kinh doanh quốc tế (Môn bổ trợ)',
                lopHocPhan: 'KDQT-ALL',
                soThuTu: '5',
                thu: 6,
                ca: 4,
                phongHoc: 'A400',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Kinh doanh quốc tế (Môn bổ trợ)',
                lopHocPhan: 'KDQT-ALL',
                soThuTu: '6',
                thu: 4,
                ca: 2,
                phongHoc: 'D110',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Quan hệ kinh tế quốc tế (Môn bổ trợ)',
                lopHocPhan: 'QHKTQT-ALL',
                soThuTu: '4',
                thu: 4,
                ca: 1,
                phongHoc: 'D110',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Quan hệ kinh tế quốc tế (Môn bổ trợ)',
                lopHocPhan: 'QHKTQT-ALL',
                soThuTu: '5',
                thu: 2,
                ca: 3,
                phongHoc: 'A404',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Quan hệ kinh tế quốc tế (Môn bổ trợ)',
                lopHocPhan: 'QHKTQT-ALL',
                soThuTu: '6',
                thu: 5,
                ca: 4,
                phongHoc: 'D110',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Đại cương truyền thông quốc tế (Môn bổ trợ)',
                lopHocPhan: 'ĐCTTQT-ALL',
                soThuTu: '1',
                thu: 6,
                ca: 3,
                phongHoc: 'D209',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Đại cương truyền thông quốc tế (Môn bổ trợ)',
                lopHocPhan: 'ĐCTTQT-ALL',
                soThuTu: '2',
                thu: 7,
                ca: 4,
                phongHoc: 'D209',
                giangVien: ''
            },
            {
                maHocPhan: 'Bổ trợ',
                tenHocPhan: 'Đại cương truyền thông quốc tế (Môn bổ trợ)',
                lopHocPhan: 'ĐCTTQT-ALL',
                soThuTu: '3',
                thu: 4,
                ca: 1,
                phongHoc: 'A300',
                giangVien: ''
            },
        //Kỹ năng Ngoại ngữ
            {
                maHocPhan: 'E.024.03',
                tenHocPhan: 'Kỹ năng thuyết trình',
                lopHocPhan: 'KNTT-ALL',
                soThuTu: '1',
                thu: 7,
                ca: 2,
                phongHoc: 'D108',
                giangVien: ''
            },
            {
                maHocPhan: 'E.024.03',
                tenHocPhan: 'Kỹ năng thuyết trình',
                lopHocPhan: 'KNTT-ALL',
                soThuTu: '2',
                thu: 2,
                ca: 1,
                phongHoc: 'D108',
                giangVien: ''
            },
            {
                maHocPhan: 'E.024.03',
                tenHocPhan: 'Kỹ năng thuyết trình',
                lopHocPhan: 'KNTT-ALL',
                soThuTu: '3',
                thu: 6,
                ca: 1,
                phongHoc: 'D108',
                giangVien: ''
            },
            {
                maHocPhan: 'E.024.03',
                tenHocPhan: 'Kỹ năng thuyết trình',
                lopHocPhan: 'KNTT-ALL',
                soThuTu: '4',
                thu: 3,
                ca: 4,
                phongHoc: 'D108',
                giangVien: ''
            },
            {
                maHocPhan: 'E.024.03',
                tenHocPhan: 'Kỹ năng thuyết trình',
                lopHocPhan: 'KNTT-ALL',
                soThuTu: '5',
                thu: 6,
                ca: 2,
                phongHoc: 'D108',
                giangVien: ''
            },
            {
                maHocPhan: 'E.024.03',
                tenHocPhan: 'Kỹ năng thuyết trình',
                lopHocPhan: 'KNTT-ALL',
                soThuTu: '6',
                thu: 5,
                ca: 4,
                phongHoc: 'D109',
                giangVien: ''
            },
            {
                maHocPhan: 'E.041.03',
                tenHocPhan: 'Kỹ năng tư duy phản biện',
                lopHocPhan: 'KNTDPB-ALL',
                soThuTu: '4',
                thu: 3,
                ca: 2,
                phongHoc: 'D107',
                giangVien: ''
            },
            {
                maHocPhan: 'E.041.03',
                tenHocPhan: 'Kỹ năng tư duy phản biện',
                lopHocPhan: 'KNTDPB-ALL',
                soThuTu: '5',
                thu: 4,
                ca: 2,
                phongHoc: 'D207',
                giangVien: ''
            },

            // Tiếng Anh chuyên ngành II
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '11.1',
                thu: 3,
                ca: 4,
                phongHoc: 'A503',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '11.2',
                thu: 6,
                ca: 3,
                phongHoc: 'A501',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '12.1',
                thu: 3,
                ca: 4,
                phongHoc: 'A505',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '12.2',
                thu: 6,
                ca: 3,
                phongHoc: 'A503',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '13.1',
                thu: 3,
                ca: 4,
                phongHoc: 'A507',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '13.2',
                thu: 6,
                ca: 3,
                phongHoc: 'A505',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '14.1',
                thu: 7,
                ca: 4,
                phongHoc: 'A205',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '14.2',
                thu: 6,
                ca: 3,
                phongHoc: 'A507',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '15.1',
                thu: 3,
                ca: 3,
                phongHoc: 'A507',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '15.2',
                thu: 6,
                ca: 4,
                phongHoc: 'A501',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '16.1',
                thu: 3,
                ca: 3,
                phongHoc: 'A605',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '16.2',
                thu: 6,
                ca: 4,
                phongHoc: 'A503',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '17.1',
                thu: 3,
                ca: 3,
                phongHoc: 'A607',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '17.2',
                thu: 6,
                ca: 4,
                phongHoc: 'A505',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '18.1',
                thu: 6,
                ca: 4,
                phongHoc: 'A507',
                giangVien: ''
            },
            {
                maHocPhan: 'E50.07.03',
                tenHocPhan: 'Tiếng Anh chuyên ngành III',
                lopHocPhan: 'TACNIII-QHQT51',
                soThuTu: '18.2',
                thu: 7,
                ca: 3,
                phongHoc: 'A503',
                giangVien: ''
            },
            // Add more English class pairs...
        ];

    // Global state management
    const selectedClasses = new Map();
    let isHidingUnselected = false;

    document.addEventListener('DOMContentLoaded', function() {
        initializeTimetable();
        setupEventListeners();
    });

    function initializeTimetable() {
        classData.forEach(classInfo => {
            const cell = document.getElementById(`cell-${classInfo.thu}-${classInfo.ca}`);
            if (cell) {
                const classSlot = document.createElement('div');
                classSlot.className = 'class-slot';
                classSlot.dataset.classInfo = JSON.stringify(classInfo);
                
                let displayText = `${classInfo.tenHocPhan}<br>(${classInfo.lopHocPhan}-${classInfo.soThuTu})<br>`;
                displayText += `Phòng: ${classInfo.phongHoc}`;
                if (classInfo.giangVien) {
                    displayText += `<br>GV: ${classInfo.giangVien}`;
                }
                
                classSlot.innerHTML = displayText;
                classSlot.addEventListener('click', () => handleClassClick(classSlot, classInfo));
                cell.appendChild(classSlot);
            }
        });
    }

    function handleClassClick(element, classInfo) {
        if (element.classList.contains('disabled')) return;

        const isSelected = element.classList.contains('selected');
        
        if (isSelected) {
            element.classList.remove('selected');
            if (classInfo.maHocPhan === 'E50.06.03') {
                const englishClasses = selectedClasses.get('E50.06.03') || [];
                selectedClasses.set('E50.06.03', 
                    englishClasses.filter(c => c.soThuTu !== classInfo.soThuTu));
                if (selectedClasses.get('E50.06.03').length === 0) {
                    selectedClasses.delete('E50.06.03');
                }
            } else {
                selectedClasses.delete(classInfo.maHocPhan);
            }
        } else {
            if (classInfo.maHocPhan === 'E50.06.03') {
                handleTACNIISelection(element, classInfo);
            } else {
                handleRegularClassSelection(element, classInfo);
            }
        }

        updateSelectedClassesList();
        updateConflicts();
        checkMissingSubjects();
    }

    function handleTACNIISelection(element, classInfo) {
        const englishClasses = selectedClasses.get('E50.06.03') || [];
        
        if (englishClasses.length >= 2) {
            showWarning("Chỉ được chọn tối đa 2 lớp Tiếng Anh chuyên ngành II");
            return;
        }

        if (englishClasses.length === 1) {
            const existingClass = englishClasses[0];
            const existingNumber = existingClass.soThuTu.split('.')[0];
            const newNumber = classInfo.soThuTu.split('.')[0];
            
            if (existingNumber !== newNumber) {
                showWarning("Vui lòng chọn cặp lớp cùng số (ví dụ: 11.1 và 11.2)");
                return;
            }
        }

        if (!hasTimeConflict(classInfo)) {
            element.classList.add('selected');
            selectedClasses.set('E50.06.03', [...englishClasses, classInfo]);
        } else {
            showWarning("Lớp này bị trùng thời gian với lớp đã chọn");
        }
    }

    function handleRegularClassSelection(element, classInfo) {
        if (!hasTimeConflict(classInfo)) {
            document.querySelectorAll('.class-slot.selected').forEach(el => {
                const info = JSON.parse(el.dataset.classInfo);
                if (info.maHocPhan === classInfo.maHocPhan) {
                    el.classList.remove('selected');
                }
            });

            element.classList.add('selected');
            selectedClasses.set(classInfo.maHocPhan, [classInfo]);
        } else {
            showWarning("Lớp này bị trùng thời gian với lớp đã chọn");
        }
    }

    function hasTimeConflict(newClass) {
        let hasConflict = false;
        selectedClasses.forEach(classes => {
            classes.forEach(existingClass => {
                if (existingClass.thu === newClass.thu && existingClass.ca === newClass.ca) {
                    hasConflict = true;
                }
            });
        });
        return hasConflict;
    }
        function updateSelectedClassesList() {
        const organizedList = document.getElementById('organizedList');
        organizedList.innerHTML = '';

        if (selectedClasses.size === 0) {
            organizedList.innerHTML = '<div class="notice">Chưa có lớp nào được chọn</div>';
            return;
        }

        // Group by days
        const dayGroups = new Map();
        selectedClasses.forEach(classes => {
            classes.forEach(classInfo => {
                const day = classInfo.thu;
                if (!dayGroups.has(day)) {
                    dayGroups.set(day, []);
                }
                dayGroups.get(day).push(classInfo);
            });
        });

        // Sort by days and display
        Array.from(dayGroups.entries())
            .sort(([dayA], [dayB]) => dayA - dayB)
            .forEach(([day, classes]) => {
                const dayGroup = document.createElement('div');
                dayGroup.className = 'time-group';
                
                const dayHeader = document.createElement('div');
                dayHeader.className = 'time-header';
                dayHeader.textContent = `Thứ ${day}`;
                dayGroup.appendChild(dayHeader);

                classes.sort((a, b) => a.ca - b.ca)
                    .forEach(classInfo => {
                        const classItem = document.createElement('div');
                        classItem.className = 'subject-item';
                        classItem.innerHTML = `
                            ${classInfo.tenHocPhan}<br>
                            Lớp: ${classInfo.lopHocPhan}-${classInfo.soThuTu}<br>
                            Ca: ${classInfo.ca} (${getTimeSlot(classInfo.ca)})<br>
                            Phòng: ${classInfo.phongHoc}
                            ${classInfo.giangVien ? '<br>GV: ' + classInfo.giangVien : ''}
                        `;
                        dayGroup.appendChild(classItem);
                    });

                organizedList.appendChild(dayGroup);
            });
    }

    function updateConflicts() {
        document.querySelectorAll('.class-slot').forEach(element => {
            if (!element.classList.contains('selected')) {
                const classInfo = JSON.parse(element.dataset.classInfo);
                
                // Check time conflicts
                const hasConflict = hasTimeConflict(classInfo);
                
                // Check if same subject is already selected (except TACNII)
                const isSameSubjectSelected = classInfo.maHocPhan !== 'E50.06.03' && 
                    selectedClasses.has(classInfo.maHocPhan);

                if (hasConflict || isSameSubjectSelected) {
                    element.classList.add('disabled');
                } else {
                    element.classList.remove('disabled');
                }
            }
        });
    }

    function checkMissingSubjects() {
        const missingSubjects = [];
        const requiredSubjects = [
            { code: 'E50.07.03', name: 'Tiếng Anh chuyên ngành III' },
            { code: 'FC.002.02', name: 'Kinh tế chính trị Mác - Lê Nin' },
            { code: 'IL.003.02', name: 'Pháp luật đại cương' },
            { code: 'IR.003.03', name: 'Phương pháp nghiên cứu quan hệ quốc tế' },
            { code: 'IR.008.03', name: 'Lý luận quan hệ quốc tế' }
            { code: 'IR.041.03', name: 'Lịch sử quan hệ quốc tế hiện đại 2' }
        ];

        requiredSubjects.forEach(subject => {
            if (!selectedClasses.has(subject.code)) {
                missingSubjects.push(subject.name);
            }
        });

        // Check supplementary subject
        const hasSupplementary = Array.from(selectedClasses.values())
            .flat()
            .some(c => c.maHocPhan === 'Bổ trợ');
        if (!hasSupplementary) {
            missingSubjects.push('Môn bổ trợ');
        }

        const warningDiv = document.getElementById('missingSubjects');
        if (missingSubjects.length > 0) {
            warningDiv.innerHTML = `
                <strong>Các môn chưa chọn:</strong>
                <ul>
                    ${missingSubjects.map(subject => `<li>${subject}</li>`).join('')}
                </ul>
            `;
            warningDiv.style.display = 'block';
        } else {
            warningDiv.style.display = 'none';
        }
    }

    function showWarning(message) {
        const warningDiv = document.getElementById('warningMessage');
        warningDiv.textContent = message;
        warningDiv.style.display = 'block';
        setTimeout(() => {
            warningDiv.style.display = 'none';
        }, 3000);
    }

    function getTimeSlot(ca) {
        const timeSlots = {
            1: "7:00 - 9:30",
            2: "9:45 - 12:15",
            3: "12:45 - 15:15",
            4: "15:30 - 18:00"
        };
        return timeSlots[ca] || "";
    }

    function setupEventListeners() {
        // Action buttons
        document.getElementById('hideUnselectedBtn').addEventListener('click', function() {
            isHidingUnselected = !isHidingUnselected;
            this.textContent = isHidingUnselected ? 'Hiện tất cả lớp' : 'Ẩn lớp không chọn';
            document.querySelectorAll('.class-slot').forEach(el => {
                if (!el.classList.contains('selected')) {
                    el.style.display = isHidingUnselected ? 'none' : 'block';
                }
            });
        });

        document.getElementById('clearSelectionsBtn').addEventListener('click', function() {
            selectedClasses.clear();
            document.querySelectorAll('.class-slot').forEach(el => {
                el.classList.remove('selected', 'disabled');
                el.style.display = 'block';
            });
            updateSelectedClassesList();
            checkMissingSubjects();
        });

        document.getElementById('exportBtn').addEventListener('click', exportToFile);
    }

    function exportToFile() {
        let content = "THỜI KHÓA BIỂU\n\n";

        // Group by days
        const dayGroups = new Map();
        selectedClasses.forEach(classes => {
            classes.forEach(classInfo => {
                const day = classInfo.thu;
                if (!dayGroups.has(day)) {
                    dayGroups.set(day, []);
                }
                dayGroups.get(day).push(classInfo);
            });
        });

        // Sort by days and create content
        Array.from(dayGroups.entries())
            .sort(([dayA], [dayB]) => dayA - dayB)
            .forEach(([day, classes]) => {
                content += `\nThứ ${day}:\n`;
                classes.sort((a, b) => a.ca - b.ca)
                    .forEach(classInfo => {
                        content += `- ${classInfo.tenHocPhan}\n`;
                        content += `  Lớp: ${classInfo.lopHocPhan}-${classInfo.soThuTu}\n`;
                        content += `  Ca: ${classInfo.ca} (${getTimeSlot(classInfo.ca)})\n`;
                        content += `  Phòng: ${classInfo.phongHoc}\n`;
                        if (classInfo.giangVien) {
                            content += `  GV: ${classInfo.giangVien}\n`;
                        }
                        content += '\n';
                    });
            });

        const blob = new Blob([content], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'thoikhoabieu.txt';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
    }
</script>
</html>
